/**
 * ColtJS Framework
 *
 * @version 0.5.1
 * @license MIT-License <http://opensource.org/licenses/MIT>
 *
 * Copyright (c) 2013 ColtJS
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is furnished to do
 * so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE
 */
define(function(){var a={routes:{},scope:{},dependencies:{},init:function(){var b,c=this;window.Colt=this;require(this.modules,function(){for(var e=0,d=arguments.length;e<d;e++){b=c.modules[e].split("/").pop();c.scope[b]=arguments[e];c.scope[b].mid=b;c.scope[b].el=document.getElementById(b);if(typeof jQuery!=="undefined"){c.scope[b].$el=jQuery("#"+b)}}c.router()});if(!Function.prototype.bind){this.polyfill_bind()}},router:function(){var e=window.location.hash,d=this;for(var c in this.scope){if(this.scope.hasOwnProperty(c)){for(var b in this.scope[c].routes){if(!this.routes.hasOwnProperty(b)){this.routes[b]=[[c,this.scope[c].routes[b]]]}else{this.routes[b].push([c,this.scope[c].routes[b]])}}}}this.loadUrl(e);window.onhashchange=function(){d.loadUrl(window.location.hash)}},loadUrl:function(f){var e,h,b={};f=f.replace("#!/","");f=f.split("?");if(f[1]){var g=f[1].split("&");for(var d=0,j=g.length;d<j;d++){var l=g[d].split("=");b[l[0]]=l[1]}}this.current_route=f[0];this.url_data=b;for(var k in this.routes){if(this.routes.hasOwnProperty(k)){for(var c=0,m=this.routes[k].length;c<m;c++){h=this.routes[k][c][0];if(f[0]===k||k==="*"){if(e!==h){e=h;this.processor(h,this.routes[k][c][1],b)}}else{this.unrender(h)}}}}},processor:function(c,f,b){var d=this.scope[c],e=this;d.loaded=true;if(!d.hasOwnProperty("template")){this.ajax({url:"templates/"+d.mid+".tpl",type:"GET",success:function(g){d.template=g;e.loadDependencies(d,function(){d[f](b)})},error:function(){console.error("Error Loading "+d.mid+".tpl")}})}else{e.loadDependencies(d,function(){d[f](b)})}},loadDependencies:function(d,i){var h=this,f,e,b=[],c=[];if(d.hasOwnProperty("dependencies")){for(var g in d.dependencies){if(d.dependencies.hasOwnProperty(g)){f=g;e=d.dependencies[g];if(h.dependencies.hasOwnProperty(e)){d[f]=h.dependencies[e]}else{b.push(f);c.push(e)}}}require(c,function(){for(var k=0,j=arguments.length;k<j;k++){d[b[k]]=arguments[k];h.dependencies[c[k]]=arguments[k]}if(i&&typeof i==="function"){i(d)}})}else{if(i&&typeof i==="function"){i(d)}}},render:function(d,e){var c=d.template,b=document.getElementById(d.mid),f=c.replace(/\{\{([^}]+)\}\}/g,function(h,g){return e[g]});b.innerHTML=f;b.style.display="block";this.delegateEvents(d.events,d)},unrender:function(b){document.getElementById(b).innerHTML="";document.getElementById(b).style.display="none"},access:function(b,e){var d=this,c=this.scope[b];if(!c.hasOwnProperty("loaded")){d.loadDependencies(c,function(f){f.loaded=true;if(e&&typeof e==="function"){e(f)}})}else{if(e&&typeof e==="function"){e(c)}}},navigate:function(e){var c=window.location,b=c.pathname.replace(/[^\/]$/,"$&"),f=this,d;if(e.length){d=b+c.search+"#!/"+e}else{d=b+c.search}if(history.pushState){history.pushState(null,document.title,d);f.loadUrl(e)}else{c.replace(b+d)}return true},delegateEvents:function(n,m){var b,f,g,d,c,h=this;if(!n){return}var j=/^(\S+)\s*(.*)$/;for(var l in n){if(n.hasOwnProperty(l)){b=n[l];f=l.match(j);g=f[1];d=f[2];c=document.querySelectorAll("#"+m.mid+" "+d);for(var e=0,k=c.length;e<k;e++){h.bindEvent(c[e],g,m[b].bind(m),true)}}}},bindEvent:function(e,c,d,b){b=b||false;if(e.addEventListener){e.addEventListener(c,function(f){if(b){f.preventDefault?f.preventDefault():f.returnValue=false}d(f)},false)}else{e.attachEvent("on"+c,function(f){if(b){f.preventDefault?f.preventDefault():f.returnValue=false}d(f)})}},ajax:function(){var h={};if(arguments.length===1){h=arguments[0]}else{h=arguments[1];h.url=arguments[0]}h.request=false;h.type=h.type||"GET";h.data=h.data||null;if(h.cache||!h.hasOwnProperty("cache")){h.cache=true}else{h.cache=false}if(h.async||!h.hasOwnProperty("async")){h.async=true}else{h.async=false}if(h.success&&typeof h.success==="function"){h.success=h.success}else{h.success=false}if(h.error&&typeof h.error==="function"){h.error=h.error}else{h.error=false}if(h.data){var f=0,b,e,c=h.data;for(var g in c){if(c.hasOwnProperty(g)){b=encodeURIComponent(g);e=encodeURIComponent(c[g]);if(f===0){h.data=b+"="+e}else{h.data+="&"+b+"="+e}f++}}h.data=h.data}function d(j){var i=h.url.split("?");if(i.length!==1){h.url+="&"+j}else{h.url+="?"+j}}if(h.data&&h.type.toUpperCase()==="GET"){d(h.data)}if(!h.cache){d(new Date().getTime())}if(window.XMLHttpRequest){h.request=new XMLHttpRequest()}else{if(window.ActiveXObject){h.request=new ActiveXObject("Microsoft.XMLHTTP")}else{return false}}h.request.onreadystatechange=function(){if(h.request.readyState===4){if(h.request.status===200){if(h.success){h.success(h.request.responseText,h.request)}}else{if(h.error){h.error(h.request)}}}};h.request.open(h.type,h.url,h.async);if(h.type.toUpperCase()==="POST"){h.request.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}h.request.send(h.data)},store:function(b,d){var c=false;if(localStorage){c=true}if(typeof d!=="undefined"&&d!==null){if(c){localStorage.setItem(b,d)}else{this.createCookie(b,d,30)}}if(typeof d==="undefined"){if(c){return localStorage.getItem(b)}else{return this.readCookie(b)}}if(d===null){if(c){localStorage.removeItem(b)}else{this.createCookie(b,"",-1)}}},createCookie:function(d,e,f){var c=new Date(),b;c.setTime(c.getTime()+(f*24*60*60*1000));b="; expires="+c.toGMTString();document.cookie=d+"="+e+b+"; path=/"},readCookie:function(f){var g=f+"=",d=document.cookie.split(";");for(var e=0,b=d.length;e<b;e++){var h=d[e];while(h.charAt(0)===" "){h=h.substring(1,h.length)}if(h.indexOf(g)===0){return h.substring(g.length,h.length)}}return null},topics:{},topic_id:0,publish:function(c,b){var d=this;if(!this.topics.hasOwnProperty(c)){return false}setTimeout(function(){var f=d.topics[c],e;if(f.length){e=f.length}else{return false}while(e--){f[e].fn(b)}},0);return true},subscribe:function(b,c){var d=++this.topic_id;if(!this.topics[b]){this.topics[b]=[]}this.topics[b].push({id:d,fn:c});return d},unsubscribe:function(e){for(var c in this.topics){if(this.topics.hasOwnProperty(c)){for(var d=0,b=this.topics[c].length;d<b;d++){if(this.topics[c][d].id===e){this.topics[c].splice(d,1);return e}}}}return false},polyfill_bind:function(){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var f=[].slice,c=f.call(arguments,1),b=this,g=function(){},d=function(){return b.apply(this instanceof g?this:(e||{}),c.concat(f.call(arguments)))};d.prototype=this.prototype;return d}}};return a});