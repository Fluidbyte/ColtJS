/**
 * Copyright (c) 2013 ColtJS
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy 
 * of this software and associated documentation files (the "Software"), to deal 
 * in the Software without restriction, including without limitation the rights 
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
 * of the Software, and to permit persons to whom the Software is furnished to do 
 * so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all 
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
define(function(){var e={routes:{},scope:{},init:function(){var t;window.Colt=e;require(e.modules,function(){for(var n=0,r=arguments.length;n<r;n++){t=e.modules[n].split("/").pop();e.scope[t]=arguments[n];e.scope[t].mid=t;e.scope[t].el=document.getElementById(t);if(typeof jQuery!=="undefined"){e.scope[t].$el=jQuery("#"+t)}}e.router()})},router:function(){var t=window.location.hash,n=null;for(var r in e.scope){for(var i in e.scope[r].routes){if(!e.routes.hasOwnProperty(i)){e.routes[i]=[[r,e.scope[r].routes[i]]]}else{e.routes[i].push([r,e.scope[r].routes[i]])}}}e.loadUrl(t);window.onhashchange=function(){e.loadUrl(window.location.hash)}},loadUrl:function(t){var n,r,i={},s;t=t.replace("#!/","");t=t.split("?");if(t[1]){var o=t[1].split("&");for(s=0;s<o.length;s++){var u=o[s].split("=");i[u[0]]=u[1]}}for(var a in e.routes){for(s=0,max=e.routes[a].length;s<max;s++){r=e.routes[a][s][0];if(t[0]===a||a==="*"){if(n!==r){n=r;e.processor(r,e.routes[a][s][1],i)}}else{document.getElementById(r).innerHTML=""}}}},processor:function(t,n,r){function s(e,t,n){var i=[],s=[];if(t.hasOwnProperty("dependencies")){for(var o in t.dependencies){i.push(o);s.push(t.dependencies[o])}require(s,function(){for(var e=0,s=arguments.length;e<s;e++){t[i[e]]=arguments[e]}t[n](r)})}else{t[n](r)}}var i=e.scope[t];if(!i.hasOwnProperty("template")){e.AJAX("templates/"+i.mid+".tpl",function(t){if(t){i.template=t;s(e,i,n)}else{console.error("Error Loading "+i.mid+".tpl")}})}else{s(e,i,n)}},render:function(e,t){var n=e.template,r=n.replace(/\{\{([^}]+)\}\}/g,function(e,n){return t[n]});document.getElementById(e.mid).innerHTML=r;this.delegateEvents(e.events,e)},navigate:function(e){var t=window.location,n=t.pathname.replace(/[^\/]$/,"$&");if(history.pushState()){history.pushState(null,document.title,t.search+"#!/"+e)}else{t.replace(n+t.search+"#!/"+e)}},delegateEvents:function(e,t){var n,r,i,s,o;if(!e){return}var u=/^(\S+)\s*(.*)$/;for(key in e){if(e.hasOwnProperty(key)){n=e[key];r=key.match(u);i=r[1];s=r[2];o=document.querySelectorAll("#"+t.mid+" "+s);(function(e,n){for(var r=0,s=e.length;r<s;r++){if(e[r].addEventListener){e[r].addEventListener(i,function(e){e.preventDefault?e.preventDefault():e.returnValue=false;t[n](e)},false)}else{e[r].attachEvent("on"+i,function(e){e.preventDefault?e.preventDefault():e.returnValue=false;t[n](e)})}}})(o,n)}}},AJAX:function(e,t,n,r,i){var s=false;e=e||"";n=n||"GET";r=r||true;i=i||null;if(window.XMLHttpRequest){s=new XMLHttpRequest}else if(window.ActiveXObject){s=new ActiveXObject("Microsoft.XMLHTTP")}if(s!==false){if(n=="GET"){e=e;i=null}s.open(n,e,r);if(n==="POST"){s.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}s.onreadystatechange=function(){if(s.readyState===4){if(typeof t==="function"){t(s.responseText)}}};s.send(i)}else{alert("Please use a browser with AJAX support!")}},store:function(e,t){function r(e,t,n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString();document.cookie=e+"="+t+i+"; path=/"}function i(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0,i=n.length;r<i;r++){var s=n[r];while(s.charAt(0)===" ")s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null}var n=false;if(localStorage){n=true}if(typeof t!=="undefined"&&t!==null){if(n){localStorage.setItem(e,t)}else{r(e,t,30)}}if(typeof t==="undefined"){if(n){return localStorage.getItem(e)}else{return i(e)}}if(t===null){if(n){localStorage.removeItem(e)}else{r(e,"",-1)}}},topics:{},topic_id:0,publish:function(t,n){if(!e.topics[t]){return false}setTimeout(function(){var r=e.topics[t],i=r?r.length:0;while(i--){r[i].fn(n)}},0);return true},subscribe:function(t,n){var r=++e.topic_id;if(!e.topics[t]){e.topics[t]=[]}e.topics[t].push({id:r,fn:n});return r},unsubscribe:function(t){for(var n in e.topics){for(var r=0,i=e.topics[n].length;r<i;r++){if(e.topics[n][r].id===t){e.topics[n].splice(r,1);return t}}}return false}};return e})