/**
 * Copyright (c) 2013 ColtJS
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy 
 * of this software and associated documentation files (the "Software"), to deal 
 * in the Software without restriction, including without limitation the rights 
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
 * of the Software, and to permit persons to whom the Software is furnished to do 
 * so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all 
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
define(function(){var a={routes:{},scope:{},dependencies:{},init:function(){var b,c=this;window.Colt=this;require(this.modules,function(){for(var e=0,d=arguments.length;e<d;e++){b=c.modules[e].split("/").pop();c.scope[b]=arguments[e];c.scope[b].mid=b;c.scope[b].el=document.getElementById(b);if(typeof jQuery!=="undefined"){c.scope[b].$el=jQuery("#"+b)}}c.router()});if(!Function.prototype.bind){this.polyfill_bind()}},router:function(){var f=window.location.hash,d=null,e=this;for(var c in this.scope){if(this.scope.hasOwnProperty(c)){for(var b in this.scope[c].routes){if(!this.routes.hasOwnProperty(b)){this.routes[b]=[[c,this.scope[c].routes[b]]]}else{this.routes[b].push([c,this.scope[c].routes[b]])}}}}this.loadUrl(f);window.onhashchange=function(){e.loadUrl(window.location.hash)}},loadUrl:function(f){var e,h,b={},d=this;f=f.replace("#!/","");f=f.split("?");if(f[1]){var g=f[1].split("&");for(var c=0,j=g.length;c<j;c++){var l=g[c].split("=");b[l[0]]=l[1]}}for(var k in this.routes){if(this.routes.hasOwnProperty(k)){for(var c=0,j=this.routes[k].length;c<j;c++){h=this.routes[k][c][0];if(f[0]===k||k==="*"){if(e!==h){e=h;this.processor(h,this.routes[k][c][1],b)}}else{document.getElementById(h).innerHTML=""}}}}},processor:function(c,g,b){var d=this.scope[c],f=this;function e(j,n){var l,k,h=[],i=[];if(j.hasOwnProperty("dependencies")){for(var m in j.dependencies){if(j.dependencies.hasOwnProperty(m)){l=m;k=j.dependencies[m];if(f.dependencies.hasOwnProperty(k)){j[l]=f.dependencies[k]}else{h.push(l);i.push(k)}}}require(i,function(){for(var p=0,o=arguments.length;p<o;p++){j[h[p]]=arguments[p];f.dependencies[i[p]]=arguments[p]}j[n](b)})}else{j[n](b)}}if(!d.hasOwnProperty("template")){this.AJAX("templates/"+d.mid+".tpl",function(h){if(h){d.template=h;e(d,g)}else{console.error("Error Loading "+d.mid+".tpl")}})}else{e(d,g)}},render:function(c,d){var b=c.template,e=b.replace(/\{\{([^}]+)\}\}/g,function(g,f){return d[f]});document.getElementById(c.mid).innerHTML=e;this.delegateEvents(c.events,c)},navigate:function(d){var c=window.location,b=c.pathname.replace(/[^\/]$/,"$&");c.replace(b+c.search+"#!/"+d);return true},delegateEvents:function(l,k){var b,f,g,d,c;_this=this;if(!l){return}var h=/^(\S+)\s*(.*)$/;for(key in l){if(l.hasOwnProperty(key)){b=l[key];f=key.match(h);g=f[1];d=f[2];c=document.querySelectorAll("#"+k.mid+" "+d);for(var e=0,j=c.length;e<j;e++){_this.bindEvent(c[e],g,k[b].bind(k),true)}}}},bindEvent:function(e,c,d,b){b=b||false;if(e.addEventListener){e.addEventListener(c,function(f){if(b){f.preventDefault?f.preventDefault():f.returnValue=false}d(f)},false)}else{e.attachEvent("on"+c,function(f){if(b){f.preventDefault?f.preventDefault():f.returnValue=false}d(f)})}},AJAX:function(b,g,f,c,e){var d=false;b=b||"";f=f||"GET";c=c||true;e=e||null;if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLHTTP")}}if(d!==false){if(f=="GET"){b=b;e=null}d.open(f,b,c);if(f==="POST"){d.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}d.onreadystatechange=function(){if(d.readyState===4){if(typeof g==="function"){g(d.responseText)}}};d.send(e)}else{alert("Please use a browser with AJAX support!")}},store:function(c,e){var d=false;if(localStorage){d=true}if(typeof e!=="undefined"&&e!==null){if(d){localStorage.setItem(c,e)}else{b(c,e,30)}}if(typeof e==="undefined"){if(d){return localStorage.getItem(c)}else{return f(c)}}if(e===null){if(d){localStorage.removeItem(c)}else{b(c,"",-1)}}function b(i,j,k){var h=new Date(),g;h.setTime(h.getTime()+(k*24*60*60*1000));g="; expires="+h.toGMTString();document.cookie=i+"="+j+g+"; path=/"}function f(k){var l=k+"=",h=document.cookie.split(";");for(var j=0,g=h.length;j<g;j++){var m=h[j];while(m.charAt(0)===" "){m=m.substring(1,m.length)}if(m.indexOf(l)===0){return m.substring(l.length,m.length)}}return null}},topics:{},topic_id:0,publish:function(c,b){var d=this;if(!this.topics.hasOwnProperty(c)){return false}setTimeout(function(){var f=d.topics[c],e;if(f.length){e=f.length}else{return false}while(e--){f[e].fn(b)}},0);return true},subscribe:function(b,c){var d=++this.topic_id;if(!this.topics[b]){this.topics[b]=[]}this.topics[b].push({id:d,fn:c});return d},unsubscribe:function(e){for(var c in this.topics){if(this.topics.hasOwnProperty(c)){for(var d=0,b=this.topics[c].length;d<b;d++){if(this.topics[c][d].id===e){this.topics[c].splice(d,1);return e}}}}return false},polyfill_bind:function(){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var f=[].slice,c=f.call(arguments,1),b=this,g=function(){},d=function(){return b.apply(this instanceof g?this:(e||{}),c.concat(f.call(arguments)))};d.prototype=this.prototype;return d}}};return a});