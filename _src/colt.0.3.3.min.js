/**
 * Copyright (c) 2013 ColtJS
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy 
 * of this software and associated documentation files (the "Software"), to deal 
 * in the Software without restriction, including without limitation the rights 
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
 * of the Software, and to permit persons to whom the Software is furnished to do 
 * so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all 
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
define(function(){var e={routes:{},scope:{},dependencies:{},init:function(){var e,t=this;window.Colt=this;require(this.modules,function(){for(var n=0,r=arguments.length;n<r;n++){e=t.modules[n].split("/").pop();t.scope[e]=arguments[n];t.scope[e].mid=e;t.scope[e].el=document.getElementById(e);if(typeof jQuery!=="undefined"){t.scope[e].$el=jQuery("#"+e)}}t.router()})},router:function(){var e=window.location.hash,t=null,n=this;for(var r in this.scope){for(var i in this.scope[r].routes){if(!this.routes.hasOwnProperty(i)){this.routes[i]=[[r,this.scope[r].routes[i]]]}else{this.routes[i].push([r,this.scope[r].routes[i]])}}}this.loadUrl(e);window.onhashchange=function(){n.loadUrl(window.location.hash)}},loadUrl:function(e){var t,n,r={},i=this;e=e.replace("#!/","");e=e.split("?");if(e[1]){var s=e[1].split("&");for(var o=0;o<s.length;o++){var u=s[o].split("=");r[u[0]]=u[1]}}for(var a in this.routes){for(var o=0,f=this.routes[a].length;o<f;o++){n=this.routes[a][o][0];if(e[0]===a||a==="*"){if(t!==n){t=n;this.processor(n,this.routes[a][o][1],r)}}else{document.getElementById(n).innerHTML=""}}}},processor:function(e,t,n){function s(e,t){var r,s,o=[],u=[];if(e.hasOwnProperty("dependencies")){for(var a in e.dependencies){r=a;s=e.dependencies[a];if(i.dependencies.hasOwnProperty(s)){e[r]=i.dependencies[s]}else{o.push(r);u.push(s)}}require(u,function(){for(var r=0,s=arguments.length;r<s;r++){e[o[r]]=arguments[r];i.dependencies[u[r]]=arguments[r]}e[t](n)})}else{e[t](n)}}var r=this.scope[e],i=this;if(!r.hasOwnProperty("template")){this.AJAX("templates/"+r.mid+".tpl",function(e){if(e){r.template=e;s(r,t)}else{console.error("Error Loading "+r.mid+".tpl")}})}else{s(r,t)}},render:function(e,t){var n=e.template,r=n.replace(/\{\{([^}]+)\}\}/g,function(e,n){return t[n]});document.getElementById(e.mid).innerHTML=r;this.delegateEvents(e.events,e)},navigate:function(e){var t=window.location,n=t.pathname.replace(/[^\/]$/,"$&");if(history.pushState()){history.pushState(null,document.title,t.search+"#!/"+e)}else{t.replace(n+t.search+"#!/"+e)}},delegateEvents:function(e,t){var n,r,i,s,o;if(!e){return}var u=/^(\S+)\s*(.*)$/;for(key in e){if(e.hasOwnProperty(key)){n=e[key];r=key.match(u);i=r[1];s=r[2];o=document.querySelectorAll("#"+t.mid+" "+s);(function(e,n){for(var r=0,s=e.length;r<s;r++){if(e[r].addEventListener){e[r].addEventListener(i,function(e){e.preventDefault?e.preventDefault():e.returnValue=false;t[n](e)},false)}else{e[r].attachEvent("on"+i,function(e){e.preventDefault?e.preventDefault():e.returnValue=false;t[n](e)})}}})(o,n)}}},AJAX:function(e,t,n,r,i){var s=false;e=e||"";n=n||"GET";r=r||true;i=i||null;if(window.XMLHttpRequest){s=new XMLHttpRequest}else if(window.ActiveXObject){s=new ActiveXObject("Microsoft.XMLHTTP")}if(s!==false){if(n=="GET"){e=e;i=null}s.open(n,e,r);if(n==="POST"){s.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}s.onreadystatechange=function(){if(s.readyState===4){if(typeof t==="function"){t(s.responseText)}}};s.send(i)}else{alert("Please use a browser with AJAX support!")}},store:function(e,t){function r(e,t,n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="; expires="+r.toGMTString();document.cookie=e+"="+t+i+"; path=/"}function i(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0,i=n.length;r<i;r++){var s=n[r];while(s.charAt(0)===" ")s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null}var n=false;if(localStorage){n=true}if(typeof t!=="undefined"&&t!==null){if(n){localStorage.setItem(e,t)}else{r(e,t,30)}}if(typeof t==="undefined"){if(n){return localStorage.getItem(e)}else{return i(e)}}if(t===null){if(n){localStorage.removeItem(e)}else{r(e,"",-1)}}},topics:{},topic_id:0,publish:function(t,n){if(!this.topics.hasOwnProperty(t)){return false}setTimeout(function(){var r=e.topics[t],i=r?r.length:0;while(i--){r[i].fn(n)}},0);return true},subscribe:function(e,t){var n=++this.topic_id;if(!this.topics[e]){this.topics[e]=[]}this.topics[e].push({id:n,fn:t});return n},unsubscribe:function(t){for(var n in e.topics){for(var r=0,i=this.topics[n].length;r<i;r++){if(this.topics[n][r].id===t){this.topics[n].splice(r,1);return t}}}return false}};return e})